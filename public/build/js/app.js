const cotizacion={id:id="",clienteId:clienteId="",productos:productos=[],total:total=0};function iniciarApp(){seleccionarProductos(),buscarCliente(),buscarProductos(),agregarProductoCotizacion(),buscarProductosTemporal(data)}document.addEventListener("DOMContentLoaded",(function(){iniciarApp()}));const nitCliente=document.querySelector("#nitCliente").addEventListener("keyup",(function(e){buscarCliente(e.target.value)})),idCliente=document.querySelector("#id_cliente"),razonSocial=document.querySelector("#razon"),telefonoCliente=document.querySelector("#telefono"),direccionCliente=document.querySelector("#direccion"),departamentoCliente=document.querySelector("#departamento"),ciudadCliente=document.querySelector("#ciudad");async function buscarCliente(e){try{const t=`${window.location.origin}/api/buscarClientes?nit=${e}`,o=await fetch(t),n=await o.json();"error"!=n&&(idCliente.value=n.id,razonSocial.value=n.razon_social,telefonoCliente.value=n.telefono,direccionCliente.value=n.direccion,departamentoCliente.value=n.departamentoId,ciudadCliente.value=n.ciudad)}catch(e){razonSocial.value="",telefonoCliente.value="",direccionCliente.value="",departamentoCliente.value="",ciudadCliente.value=""}}const codigoProducto=document.querySelector("#codigoProducto").addEventListener("keyup",(function(e){buscarProductos(e.target.value)})),productoNombre=document.querySelector("#nombreProducto"),descripcionProducto=document.querySelector("#descripcionProducto"),precioProducto=document.querySelector("#precioProducto"),idProducto=document.querySelector("#idProducto");async function buscarProductos(e){try{const t=`${window.location.origin}/api/buscarProductos?producto=${e}`,o=await fetch(t),n=await o.json();"error"!=n&&(productoNombre.value=n.nombre,descripcionProducto.value=n.descripcion,precioProducto.value="$."+parseInt(n.precio),precioProducto.setAttribute("value",n.precio),idProducto.value=n.id)}catch(e){productoNombre.value="",descripcionProducto.value="",precioProducto.value="",idProducto.value=""}}const agregarProducto=document.querySelector("#agregarProducto"),server=window.location.origin;async function mostrarProductos(){const e=window.location.origin+"/api/obtenerTemporal",t=await fetch(e);mostrarProducto(await t.json())}function mostrarProducto(e){const t=document.querySelector(".detalles"),o=e.pop(),{cantidad:n,descuento:c,id:r,numero_producto:d,precio:a,producto:i}=o,u=document.createElement("p");u.classList.add("cod-producto"),u.textContent=d;const l=document.createElement("H3");l.textContent=i;const s=document.createElement("H3");s.textContent="$"+a;const p=document.createElement("DIV");p.classList.add("cantidades");const m=document.createElement("P");m.textContent=n+" Unidades";const C=document.createElement("P");C.textContent=c+"%",p.appendChild(m),p.appendChild(C);const P=a*n,v=P-P*c/100,y=document.createElement("H4");y.textContent="$."+v;const h=document.createElement("DIV");h.classList.add("producto"),h.dataset.idtemporal=r,h.appendChild(u),h.appendChild(l),h.appendChild(s),h.appendChild(p),h.appendChild(y),t.appendChild(h),mostrarTotal(v)}function mostrarTotal(e){const t=e,o=.19*t,n=t+o,c=document.querySelector(".total"),r=document.createElement("H4");r.textContent="$."+t;const d=document.createElement("P");d.textContent=o;const a=document.createElement("H3");a.textContent=n,c.appendChild(r),c.appendChild(d),c.appendChild(a);document.querySelector(".totales").appendChild(c)}agregarProducto.addEventListener("submit",(function(e){e.preventDefault();const t=new FormData(agregarProducto);fetch(server+"/api/temporal",{method:"POST",body:t}).then(e=>e.json()).then(e=>{mostrarProductos()})}));